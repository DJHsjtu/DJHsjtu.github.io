var Ge=Object.create;var q=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var He=Object.getOwnPropertyNames;var $e=Object.getPrototypeOf,Ve=Object.prototype.hasOwnProperty;var K=m=>q(m,"__esModule",{value:!0});var je=(m,e)=>{K(m);for(var t in e)q(m,t,{get:e[t],enumerable:!0})},ze=(m,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of He(e))!Ve.call(m,r)&&r!=="default"&&q(m,r,{get:()=>e[r],enumerable:!(t=Be(e,r))||t.enumerable});return m},c=m=>ze(K(q(m!=null?Ge($e(m)):{},"default",m&&m.__esModule&&"default"in m?{get:()=>m.default,enumerable:!0}:{value:m,enumerable:!0})),m);var i=(m,e,t)=>new Promise((r,o)=>{var a=l=>{try{s(t.next(l))}catch(p){o(p)}},d=l=>{try{s(t.throw(l))}catch(p){o(p)}},s=l=>l.done?r(l.value):Promise.resolve(l.value).then(a,d);s((t=t.apply(m,e)).next())});je(exports,{default:()=>J});var E=c(require("obsidian"));var ye=c(require("obsidian"));var W={};var X={};var Z={};var Q={};var A={broken:"Emo broken. Check your target","upload error":" upload error","parms error":"Emo need more prams","target hosting":"target hosting","target hosting desc":"Choose your target. Before uploading, make sure you have completely filled in the necessary parameters of the selected platform.","Cloudinary Settings":"Cloudinary Settings","Upload Folder desc":"Folder name to use in Cloudinary.  Note, this will be ignored if you have a folder set in your Cloudinary Upload Preset.","Github Settings":"Github Settings",owner:"owner",repo:"repo",branch:"branch",token:"token",message:"message",path:"path","random filename":"random filename","random filename desc":"Random file names will greatly avoid duplicate file names. If you are sure that you need to use the original file name during this upload, make sure that no duplicate naming will occur under the path you choose.","imgbb Settings":"imgbb Settings",tips:"Tips","tips text":`Imgur anonymous upload will produce the link in this format: ![deletehash](url).
 [deletehash] is used to delete the image you just uploaded.
 If your note will be used for publicity, please remember to delete it in time.
 Authentication upload can be deleted on Imgur.`,"Imgur Settings":"Imgur Settings","Anonymous Upload":"Anonymous Upload","Anonymous Upload desc":"Files uploaded anonymously will not show in your Imgur account.",imgurid:"id","built-in id desc":"The built-in ID has a daily usage limit, if it is temporarily invalid, you can use your own client ID to upload and delete.",delete:"delete","delete desc":"If you want to delete the image on Imgur, delete it here with the deletehash.","delete btn":"Delete","delete done":"delete done","delete fail":"delete fail",authenticate:"authenticate","auth desc":"Sometimes the auth results need to be refreshed manually before they are displayed.","imgur account":"Authenticated as: ","auth error":"Authentication failed with error: ","sign in":"sign in","Sign Out":"Sign Out","ImgURL Settings":"ImgURL Settings","SM.MS Settings":"SM.MS Settings","Catbox Settings":"Catbox Settings"};var ee={};var te={};var re={};var oe={};var ae={};var se={};var ie={};var ne={};var me={};var le={};var de={};var ue={};var pe={};var ce={};var ge={};var he={};var fe={broken:"Emo\u5DE5\u4F5C\u5F02\u5E38\uFF0C\u68C0\u89C6\u4F60\u7684\u76EE\u6807\u5E73\u53F0\u9009\u62E9","upload error":"\u4E0A\u4F20\u5931\u8D25","parms error":"\u5F53\u524D\u5E73\u53F0\u6240\u9700\u5FC5\u8981\u53C2\u6570\u672A\u586B\u5199\u5B8C\u5168","target hosting":"\u6258\u7BA1\u5E73\u53F0","target hosting desc":"\u9009\u62E9\u76EE\u6807\u3002\u4E0A\u4F20\u4E4B\u524D\uFF0C\u8BF7\u786E\u4FDD\u6240\u9009\u5E73\u53F0\u7684\u5FC5\u8981\u53C2\u6570\u5DF2\u586B\u5199\u5B8C\u6210\u3002","Cloudinary Settings":"Cloudinary\u914D\u7F6E","Upload Folder desc":"\u8981\u5728Cloudinary\u4E2D\u4F7F\u7528\u7684\u6587\u4EF6\u5939\u540D\u79F0\u3002\u6CE8\u610F\uFF0C\u5982\u679C\u5728Cloudinary\u9884\u8BBE\u4E86\u6587\u4EF6\u5939\uFF0C\u5219\u4F1A\u5FFD\u7565\u6B64\u9879\u3002","Github Settings":"Github\u914D\u7F6E",owner:"\u7528\u6237\u540D",repo:"\u4ED3\u5E93",branch:"\u5206\u652F",token:"\u4EE4\u724C",message:"\u63D0\u4EA4\u4FE1\u606F",path:"\u8DEF\u5F84","random filename":"\u968F\u673A\u6587\u4EF6\u540D","random filename desc":"\u91C7\u7528\u968F\u673A\u6587\u4EF6\u540D\u5C06\u6781\u5927\u907F\u514D\u91CD\u540D\u3002\u5982\u679C\u786E\u5B9A\u5728\u4E0A\u4F20\u8FC7\u7A0B\u4E2D\u9700\u8981\u4F7F\u7528\u539F\u6587\u4EF6\u540D\uFF0C\u8BF7\u786E\u4FDD\u6240\u9009\u8DEF\u5F84\u4E0B\u4E0D\u4F1A\u51FA\u73B0\u91CD\u540D\u95EE\u9898\u3002","imgbb Settings":"imgbb\u914D\u7F6E",tips:"\u8D34\u58EB","tips text":`Imgur\u533F\u540D\u4E0A\u4F20\u5C06\u751F\u6210\u4EE5\u4E0B\u683C\u5F0F\u7684\u94FE\u63A5\uFF1A![deletehash](url)\u3002
  [deletehash]\u7528\u4E8E\u5220\u9664\u521A\u521A\u4E0A\u4F20\u7684\u56FE\u50CF\u3002
  \u5982\u679C\u60A8\u7684\u7B14\u8BB0\u4F1A\u88AB\u516C\u5F00\uFF0C\u8BF7\u53CA\u65F6\u5728\u7B14\u8BB0\u4E2D\u5220\u9664deletehash\u3002
  \u8BA4\u8BC1\u4E0A\u4F20\u53EF\u5728Imgur\u4E0A\u5220\u9664\u3002`,"Imgur Settings":"Imgur\u914D\u7F6E","Anonymous Upload":"\u533F\u540D\u4E0A\u4F20","Anonymous Upload desc":"\u533F\u540D\u4E0A\u4F20\u7684\u6587\u4EF6\u4E0D\u4F1A\u663E\u793A\u5728Imgur\u5E10\u6237\u4E2D\u3002",imgurid:"\u5BA2\u6237\u7AEFid","built-in id desc":"\u5185\u7F6EID\u6709\u6BCF\u65E5\u4F7F\u7528\u9650\u5236\uFF0C\u5982\u679C\u6682\u65F6\u5931\u6548\uFF0C\u53EF\u4EE5\u4F7F\u7528\u81EA\u5DF1\u7684\u5BA2\u6237\u7AEFID\u4EE5\u8FDB\u884C\u4E0A\u4F20\u548C\u5220\u9664\u3002",delete:"\u5220\u9664","delete desc":"\u5982\u679C\u9700\u8981\u5220\u9664Imgur\u4E0A\u7684\u56FE\u50CF\uFF0C\u8BF7\u5728\u6B64\u5904\u4F7F\u7528deletehash\u5C06\u5176\u5220\u9664\u3002","delete btn":"\u5220\u9664","delete done":"\u5220\u9664\u6210\u529F","delete fail":"\u5220\u9664\u5931\u8D25",authenticate:"\u8BA4\u8BC1","auth desc":"\u6709\u65F6\u9700\u8981\u624B\u52A8\u5237\u65B0\u4EE5\u663E\u793A\u8BA4\u8BC1\u7ED3\u679C\u3002","imgur account":"\u5F53\u524D\u7528\u6237\uFF1A ","auth error":"\u8BA4\u8BC1\u9519\u8BEF: ","sign in":"\u767B\u5F55","Sign Out":"\u6CE8\u9500","ImgURL Settings":"ImgURL\u914D\u7F6E","SM.MS Settings":"SM.MS\u914D\u7F6E","Catbox Settings":"Catbox\u914D\u7F6E"};var be={broken:"Emo\u5DE5\u4F5C\u7570\u5E38\uFF0C\u6AA2\u8996\u4F60\u7684\u76EE\u6A19\u5E73\u53F0\u9078\u64C7","upload error":"\u4E0A\u50B3\u5931\u6557","parms error":"\u76EE\u524D\u5E73\u53F0\u6240\u9700\u5FC5\u8981\u53C3\u6578\u672A\u586B\u5BEB\u5B8C\u5168","target hosting":"\u8A17\u7BA1\u5E73\u53F0","target hosting desc":"\u9078\u64C7\u76EE\u6A19\u3002\u4E0A\u50B3\u4E4B\u524D\uFF0C\u8ACB\u78BA\u4FDD\u6240\u9078\u5E73\u53F0\u7684\u5FC5\u8981\u53C3\u6578\u5DF2\u586B\u5BEB\u5B8C\u6210\u3002","Cloudinary Settings":"Cloudinary\u914D\u7F6E","Upload Folder desc":"\u8981\u5728Cloudinary\u4E2D\u4F7F\u7528\u7684\u8CC7\u6599\u593E\u540D\u7A31\u3002\u6CE8\u610F\uFF0C\u5982\u679C\u5728Cloudinary\u9810\u8A2D\u4E86\u8CC7\u6599\u593E\uFF0C\u5247\u6703\u5FFD\u7565\u6B64\u9805\u3002","Github Settings":"Github\u914D\u7F6E",owner:"\u4F7F\u7528\u8005\u540D\u7A31",repo:"\u5132\u5B58\u5EAB",branch:"\u5206\u652F",token:"\u4EE4\u724C",message:"\u63D0\u4EA4\u8CC7\u8A0A",path:"\u8DEF\u5F91","random filename":"\u96A8\u6A5F\u6A94\u540D","random filename desc":"\u63A1\u7528\u96A8\u6A5F\u6A94\u540D\u5C07\u6975\u5927\u907F\u514D\u91CD\u540D\u3002\u5982\u679C\u78BA\u5B9A\u5728\u4E0A\u50B3\u904E\u7A0B\u4E2D\u9700\u8981\u4F7F\u7528\u539F\u6A94\u540D\uFF0C\u8ACB\u78BA\u4FDD\u6240\u9078\u8DEF\u5F91\u4E0B\u4E0D\u6703\u51FA\u73FE\u91CD\u540D\u554F\u984C\u3002","imgbb Settings":"imgbb\u914D\u7F6E",tips:"\u5C0F\u6280\u5DE7","tips text":`Imgur\u533F\u540D\u4E0A\u50B3\u5C07\u7522\u751F\u4EE5\u4E0B\u683C\u5F0F\u7684\u93C8\u63A5\uFF1A![deletehash](url)\u3002
  [deletehash]\u7528\u65BC\u522A\u9664\u525B\u525B\u4E0A\u50B3\u7684\u5F71\u50CF\u3002
  \u5982\u679C\u60A8\u7684\u7B46\u8A18\u6703\u88AB\u516C\u958B\uFF0C\u8ACB\u53CA\u6642\u5728\u7B46\u8A18\u4E2D\u522A\u9664deletehash\u3002
  \u8A8D\u8B49\u4E0A\u50B3\u53EF\u5728Imgur\u4E0A\u522A\u9664`,"Imgur Settings":"Imgur\u914D\u7F6E","Anonymous Upload":"\u533F\u540D\u4E0A\u50B3","Anonymous Upload desc":"\u533F\u540D\u4E0A\u50B3\u7684\u6A94\u6848\u4E0D\u6703\u986F\u793A\u5728Imgur\u5E33\u6236\u4E2D\u3002",imgurid:"\u5BA2\u6236\u7AEFid","built-in id desc":"\u5167\u5EFAID\u6709\u6BCF\u65E5\u4F7F\u7528\u9650\u5236\uFF0C\u5982\u679C\u66AB\u6642\u5931\u6548\uFF0C\u53EF\u4EE5\u4F7F\u7528\u81EA\u5DF1\u7684\u5BA2\u6236\u7AEFID\u4EE5\u9032\u884C\u4E0A\u50B3\u548C\u522A\u9664\u3002",delete:"\u522A\u9664","delete desc":"\u5982\u679C\u9700\u8981\u522A\u9664Imgur\u4E0A\u7684\u5F71\u50CF\uFF0C\u8ACB\u5728\u6B64\u8655\u4F7F\u7528deletehash\u5C07\u5176\u522A\u9664\u3002","delete btn":"\u522A\u9664","delete done":"\u522A\u9664\u6210\u529F","delete fail":"\u522A\u9664\u5931\u6557",authenticate:"\u8A8D\u8B49","auth desc":"\u6709\u6642\u9700\u8981\u624B\u52D5\u91CD\u65B0\u6574\u7406\u4EE5\u986F\u793A\u8A8D\u8B49\u7D50\u679C\u3002","imgur account":"\u76EE\u524D\u4F7F\u7528\u8005\uFF1A ","auth error":"\u8A8D\u8B49\u932F\u8AA4: ","sign in":"\u767B\u9304","Sign Out":"\u8A3B\u92B7","ImgURL Settings":"ImgURL\u914D\u7F6E","SM.MS Settings":"SM.MS\u914D\u7F6E","Catbox Settings":"Catbox\u914D\u7F6E"};var Ye={ar:W,cs:X,da:Z,de:Q,en:A,"en-gb":ee,es:te,fr:re,hi:oe,id:ae,it:se,ja:ie,ko:ne,nl:me,nn:le,pl:de,pt:ue,"pt-br":pe,ro:ce,ru:ge,tr:he,"zh-cn":fe,"zh-tw":be},U=Ye[ye.moment.locale()];function n(m){var e;return(e=U==null?void 0:U[m])!=null?e:A[m]}var _=c(require("obsidian"));var xe={required:{userhash:""}};var Pe={required:{name:"",present:""},folder:""};var Se={required:{owner:"",repo:"",branch:"main",token:"",message:"from emo-uploader\xB7Github"},path:"",random:!0};var we={required:{key:""}};var Ee={required:{emoid:"4547d4aee97ce8f"},clientid:"",anonymous:!0};var Te={required:{uid:"",token:""}};var Ce={required:{token:""}};var u;(function(s){s.Github="Github",s.Cloudinary="Cloudinary",s.Catbox="Catbox",s.Imgur="Imgur",s.Smms="SM.MS",s.ImgURL="ImgURL",s.Imgbb="imgbb"})(u||(u={}));var qe={choice:u.Github,github_parms:Se,imgur_parms:Ee,cloudinary_parms:Pe,smms_parms:Ce,imgurl_parms:Te,imgbb_parms:we,catbox_parms:xe};var I=c(require("obsidian"));var g=class{constructor(e,t,r){this.kind=e,this.element=t.createDiv(e),this.display(this.element,r),this.element.hide()}update(e){this.kind===e?this.element.show():this.element.hide()}};var R=class extends g{constructor(e,t){super(u.Cloudinary,e,t)}display(e,t){let r=t.config.cloudinary_parms;e.createEl("h3",{text:n("Cloudinary Settings")}),new I.Setting(e).setName("Cloud Name").addText(o=>{o.setPlaceholder("").setValue(r.required.name).onChange(a=>i(this,null,function*(){r.required.name=a,yield t.saveSettings()}))}),new I.Setting(e).setName("Upload Presets").addText(o=>{o.setPlaceholder("").setValue(r.required.present).onChange(a=>i(this,null,function*(){r.required.present=a,yield t.saveSettings()}))}),new I.Setting(e).setName("Upload Folder").setDesc(n("Upload Folder desc")).addText(o=>{o.setPlaceholder("obsidian -> obsidian/pic.png").setValue(r.folder).onChange(a=>i(this,null,function*(){r.folder=a,yield t.saveSettings()}))})}};var x=c(require("obsidian"));var k=class extends g{constructor(e,t){super(u.Github,e,t)}display(e,t){let r=t.config.github_parms;e.createEl("h3",{text:n("Github Settings")}),new x.Setting(e).setName(n("owner")).addText(o=>{o.setPlaceholder("").setValue(r.required.owner).onChange(a=>i(this,null,function*(){r.required.owner=a,yield t.saveSettings()}))}),new x.Setting(e).setName(n("repo")).addText(o=>{o.setPlaceholder("").setValue(r.required.repo).onChange(a=>i(this,null,function*(){r.required.repo=a,yield t.saveSettings()}))}),new x.Setting(e).setName(n("branch")).addText(o=>{o.setPlaceholder("").setValue(r.required.branch).onChange(a=>i(this,null,function*(){r.required.branch=a,yield t.saveSettings()}))}),new x.Setting(e).setName(n("token")).addText(o=>{o.setPlaceholder("").setValue(r.required.token).onChange(a=>i(this,null,function*(){r.required.token=a,yield t.saveSettings()}))}),new x.Setting(e).setName(n("message")).addText(o=>{o.setPlaceholder("").setValue(r.required.message).onChange(a=>i(this,null,function*(){r.required.message=a,yield t.saveSettings()}))}),new x.Setting(e).setName(n("path")).addText(o=>{o.setPlaceholder("obsidian/ -> obsidian/pic.png").setValue(r.path).onChange(a=>i(this,null,function*(){r.path=a,yield t.saveSettings()}))}),new x.Setting(e).setName(n("random filename")).setDesc(n("random filename desc")).addToggle(o=>{o.setValue(r.random),o.onChange(a=>i(this,null,function*(){r.random=a,yield t.saveSettings()}))})}};var Ie=c(require("obsidian"));var D=class extends g{constructor(e,t){super(u.Imgbb,e,t)}display(e,t){let r=t.config.imgbb_parms;e.createEl("h3",{text:n("imgbb Settings")}),new Ie.Setting(e).setName("key").addText(o=>{o.setPlaceholder("").setValue(r.required.key).onChange(a=>i(this,null,function*(){r.required.key=a,yield t.saveSettings()}))})}};var M=c(require("obsidian"));var L=class extends g{constructor(e,t){super(u.ImgURL,e,t)}display(e,t){let r=t.config.imgurl_parms;e.createEl("h3",{text:n("ImgURL Settings")}),new M.Setting(e).setName("uid").addText(o=>{o.setPlaceholder("").setValue(r.required.uid).onChange(a=>i(this,null,function*(){r.required.uid=a,yield t.saveSettings()}))}),new M.Setting(e).setName("token").addText(o=>{o.setPlaceholder("").setValue(r.required.token).onChange(a=>i(this,null,function*(){r.required.token=a,yield t.saveSettings()}))})}};var _e=c(require("obsidian"));var F=class extends g{constructor(e,t){super(u.Smms,e,t)}display(e,t){let r=t.config.smms_parms;e.createEl("h3",{text:n("SM.MS Settings")}),new _e.Setting(e).setName("token").addText(o=>{o.setPlaceholder("").setValue(r.required.token).onChange(a=>i(this,null,function*(){r.required.token=a,yield t.saveSettings()}))})}};var y=c(require("obsidian"));var S="imgur-access_token",T="4547d4aee97ce8f",w="Imgur no sign in !",v="loveaimeainixucheng",f="multipart/form-data;boundary="+v;var N=class extends g{constructor(e,t){super(u.Imgur,e,t);this.authenticated=!1;t.initDone||(t.registerObsidianProtocolHandler("emo-imgur-oauth",r=>i(this,null,function*(){if(r.error!==void 0){console.log(new y.Notice(n("auth error")+`${r.error}`));return}let o=r.hash.split("&").map(d=>{let s=d.split("=");return[s[0],s[1]]}),a=new Map(o);localStorage.setItem(S,a.get("access_token")),this.authenticated=yield this.updateAccountState()})),t.initDone=!0)}display(e,t){return i(this,null,function*(){let r=t.config.imgur_parms;e.createEl("h3",{text:n("tips")}),e.createDiv().setText(n("tips text")),e.createEl("h3",{text:n("Imgur Settings")}),new y.Setting(e).setName(n("Anonymous Upload")).setDesc(n("Anonymous Upload desc")).addToggle(s=>{s.setValue(r.anonymous),s.onChange(l=>i(this,null,function*(){r.anonymous=l,yield t.saveSettings()}))}),new y.Setting(e).setName(n("imgurid")).setDesc(n("built-in id desc")).addText(s=>{s.setPlaceholder("").setValue(r.clientid).onChange(l=>i(this,null,function*(){r.clientid=l,yield t.saveSettings()}))});let o="";new y.Setting(e).setName(n("delete")).setDesc(n("delete desc")).addText(s=>{s.setPlaceholder("deletehash").onChange(l=>i(this,null,function*(){o=l}))}).addButton(s=>{s.setCta().setButtonText(n("delete btn")).onClick(()=>{let l="Client-ID ";r.clientid!==""?l+=r.clientid:l+=T;let p={url:"https://api.imgur.com/3/image/"+o,method:"DELETE",headers:{Authorization:l}};(0,y.request)(p).then(()=>{console.log(new y.Notice(n("delete done"),2e3))}).catch(()=>{console.log(new y.Notice(n("delete fail"),2e3))})})});let a=n("authenticate"),d=n("sign in");try{let s=yield this.getAccountName();s!==w&&(a=n("imgur account")+`${s} \u2705`,d=n("Sign Out"),this.authenticated=!0)}catch(s){console.log(s)}this.loginPart=new y.Setting(e),this.loginPart.setName(a).setDesc(n("auth desc")).addButton(s=>{this.loginBtn=s,s.setCta().setButtonText(d).onClick(()=>i(this,null,function*(){if(this.authenticated)localStorage.removeItem(S),this.authenticated=yield this.updateAccountState();else{let l="";r.clientid!==""?l+=r.clientid:l+=T,window.open(`https://api.imgur.com/oauth2/authorize?client_id=${l}&response_type=token`)}}))})})}getAccountName(){return i(this,null,function*(){let e=localStorage.getItem(S);if(e===null)return w;let t=yield fetch("https://api.imgur.com/3/account/me",{headers:new Headers({Authorization:`Bearer ${e}`})});if(!t.ok)throw new Error("Imgur account error");return(yield t.json()).data.url})}updateAccountState(){return i(this,null,function*(){let e=n("authenticate"),t=n("sign in"),r=!1;try{let o=yield this.getAccountName();o!==w&&(e=n("imgur account")+`${o} \u2705`,t=n("Sign Out"),r=!0)}catch(o){console.log(o)}return this.loginPart.setName(e),this.loginBtn.setButtonText(t),r})}};var Ae=c(require("obsidian"));var O=class extends g{constructor(e,t){super(u.Catbox,e,t)}display(e,t){let r=t.config.catbox_parms;e.createEl("h3",{text:n("Catbox Settings")}),new Ae.Setting(e).setName("userhash").addText(o=>{o.setPlaceholder("").setValue(r.required.userhash).onChange(a=>i(this,null,function*(){r.required.userhash=a,yield t.saveSettings()}))})}};var G=class extends _.PluginSettingTab{constructor(e,t){super(e,t);this.fragmentList=[];this.plugin=t}display(){let{containerEl:e}=this;e.empty();let t=e.createDiv("cola");t.addClass("emo-cola-div");let o=t.createEl("a",{href:"https://lestua.eu.org/donate"}).createEl("img");o.outerHTML='<?xml version="1.0" encoding="UTF-8"?><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><line x1="10" y1="16" x2="38" y2="16" stroke="currentcolor" stroke-width="4" stroke-linecap="round"/><path d="M14.153 18.1425C14.0703 16.9848 14.9873 16 16.148 16H31.852C33.0127 16 33.9297 16.9848 33.847 18.1425L32.1327 42.1425C32.0579 43.1891 31.187 44 30.1378 44H17.8622C16.813 44 15.9421 43.1891 15.8673 42.1425L14.153 18.1425Z" stroke="currentcolor" stroke-width="4"/><path d="M24 10V6C24 4.89543 24.8954 4 26 4H29" stroke="currentcolor" stroke-width="4" stroke-linecap="round"/><path d="M14.7215 11.6712C14.8822 10.7068 15.7166 10 16.6943 10H31.3057C32.2834 10 33.1178 10.7068 33.2785 11.6712L34 16H14L14.7215 11.6712Z" fill="none" stroke="currentcolor" stroke-width="4"/></svg>',e.createEl("h2",{text:"Emo"});let a=new _.Setting(e).setName(n("target hosting")).setDesc(n("target hosting desc"));this.fragmentList.push(new k(e,this.plugin)),this.fragmentList.push(new N(e,this.plugin)),this.fragmentList.push(new R(e,this.plugin)),this.fragmentList.push(new F(e,this.plugin)),this.fragmentList.push(new L(e,this.plugin)),this.fragmentList.push(new D(e,this.plugin)),this.fragmentList.push(new O(e,this.plugin)),this.fragmentList.forEach(s=>{s.update(this.plugin.config.choice)});let d=[];for(let s in u)d.push(u[s]);a.addDropdown(s=>{d.forEach(l=>{s.addOption(l,l)}),s.setValue(this.plugin.config.choice).onChange(l=>i(this,null,function*(){this.plugin.config.choice=l,yield this.plugin.saveSettings(),this.fragmentList.forEach(p=>{p.update(this.plugin.config.choice)})}))})}};var De=c(require("obsidian"));function Ue(m){return i(this,null,function*(){return yield new Promise((e,t)=>{let r=new FileReader,o;r.readAsArrayBuffer(m),r.onload=()=>{o=r.result},r.onerror=a=>{t(a)},r.onloadend=()=>{e(o)}})})}function Re(m){return i(this,null,function*(){return yield new Promise((e,t)=>{let r=new FileReader,o;r.readAsDataURL(m),r.onload=()=>{o=r.result,o=o.slice(o.indexOf(",")+1)},r.onerror=a=>{t(a)},r.onloadend=()=>{e(o)}})})}function ke(){return Date.parse(new Date().toString()).toString()+(Math.random()*10086).toString(36).slice(-6)}var h=class{isValid(){let e=!0;for(let t in this.parms.required)if(e&&(e=Je(this.parms.required[t])),!e)return!1;return!0}};function Je(m){return m.length>0}var B=class extends h{constructor(e){super();this.parms=e}upload(e){return i(this,null,function*(){let t="";if(this.parms.random){let d=e.name.lastIndexOf(".");t=this.parms.path+ke(),t+=d>0?e.name.substring(d):""}else t=this.parms.path+e.name;let r={owner:this.parms.required.owner,repo:this.parms.required.repo,branch:this.parms.required.branch,path:t,message:this.parms.required.message,content:yield Re(e)},o=JSON.stringify(r),a={url:`https://api.github.com/repos/${this.parms.required.owner}/${this.parms.required.repo}/contents/${t}`,method:"PUT",headers:{Authorization:`token ${this.parms.required.token}`},body:o};return yield new Promise((d,s)=>{(0,De.request)(a).then(()=>{let l=`![gh](https://fastly.jsdelivr.net/gh/${this.parms.required.owner}/${this.parms.required.repo}@${this.parms.required.branch}/${t})`;d(l)}).catch(l=>{s(l)})})})}};var Me=c(require("obsidian"));var b=class{constructor(){this.randomBoundary=v;this.result=[],this.boundary="--"+this.randomBoundary,this.endBoundary=this.boundary+"--"}addParm(e,t){let r=this.boundary+`\r
`;r+='Content-Disposition: form-data; name="'+e+`"\r
\r
`,r+=t+`\r
`;for(let o=0;o<r.length;o++)this.result.push(r.charCodeAt(o))}addFile(e,t){return i(this,null,function*(){let r=this.boundary+`\r
`;r+='Content-Disposition: form-data; name="'+e+'"; filename="'+t.name+`"\r
`,r+="Content-Type: "+t.type+`\r
\r
`;for(let a=0;a<r.length;a++)this.result.push(r.charCodeAt(a));yield Ue(t).then(a=>{let d=new Uint8Array(a);this.result=this.result.concat(Array.prototype.slice.call(d))});let o=`\r
`;for(let a=0;a<o.length;a++)this.result.push(o.charCodeAt(a))})}pack(){let e=[];for(let t=0;t<this.endBoundary.length;t++)e.push(this.endBoundary.charCodeAt(t));return this.result=this.result.concat(e),new Uint8Array(this.result).buffer}};var H=class extends h{constructor(e){super();this.parms=e}upload(e){return i(this,null,function*(){let t=new b;t.addParm("uid",this.parms.required.uid),t.addParm("token",this.parms.required.token),yield t.addFile("file",e);let r=t.pack(),o={url:"https://www.imgurl.org/api/v2/upload",method:"POST",headers:{"Content-Type":f},body:r};return yield new Promise((a,d)=>{(0,Me.request)(o).then(s=>{let p=`![ImgURL](${JSON.parse(s).data.url})`;a(p)}).catch(s=>{d(s)})})})}};var Le=c(require("obsidian"));var $=class extends h{constructor(e){super();this.parms=e}upload(e){return i(this,null,function*(){let t=new b;t.addParm("upload_preset",this.parms.required.present),t.addParm("folder",this.parms.folder),yield t.addFile("file",e);let r=t.pack(),o={url:`https://api.cloudinary.com/v1_1/${this.parms.required.name}/auto/upload`,method:"POST",headers:{"Content-Type":f},body:r};return yield new Promise((a,d)=>{(0,Le.request)(o).then(s=>{let p=`![Cloudinary](${JSON.parse(s).secure_url})`;a(p)}).catch(s=>{d(s)})})})}};var Fe=c(require("obsidian"));var V=class extends h{constructor(e){super();this.parms=e}upload(e){return i(this,null,function*(){let t=new b;t.addParm("format","json"),yield t.addFile("smfile",e);let r=t.pack(),o={url:"https://sm.ms/api/v2/upload",method:"POST",headers:{"Content-Type":f,Authorization:this.parms.required.token},body:r};return yield new Promise((a,d)=>{(0,Fe.request)(o).then(s=>{let l=JSON.parse(s),p="";try{p=l.data.url}catch(C){p=l.images}let P=`![SMMS](${p})`;a(P)}).catch(s=>{d(s)})})})}};var ve=c(require("obsidian"));var j=class extends h{constructor(e){super();this.parms=e}upload(e){return i(this,null,function*(){let t=new b;t.addParm("key",this.parms.required.key),yield t.addFile("image",e);let r=t.pack(),o={url:"https://api.imgbb.com/1/upload",method:"POST",headers:{"Content-Type":f},body:r};return yield new Promise((a,d)=>{(0,ve.request)(o).then(s=>{let P=`![imgbb](${JSON.parse(s).data.url})`;a(P)}).catch(s=>{d(s)})})})}};var Ne=c(require("obsidian"));var z=class extends h{constructor(e){super();this.parms=e}upload(e){return i(this,null,function*(){let t=new b;yield t.addFile("image",e);let r=t.pack(),o;if(this.parms.anonymous){let a="Client-ID ";this.parms.clientid!==""?a+=this.parms.clientid:a+=T,o={url:"https://api.imgur.com/3/upload",method:"POST",headers:{"Content-Type":f,Authorization:a},body:r}}else{let a=localStorage.getItem(S);if(a!==null)o={url:"https://api.imgur.com/3/image",method:"POST",headers:{"Content-Type":f,Authorization:`Bearer ${a}`},body:r};else return w}return yield new Promise((a,d)=>{(0,Ne.request)(o).then(s=>{let l=JSON.parse(s),p=l.data.deletehash,P=l.data.link,C;this.parms.anonymous?C=`![${p}](${P})`:C=`![Imgur](${P})`,a(C)}).catch(s=>{d(s)})})})}};var Oe=c(require("obsidian"));var Y=class extends h{constructor(e){super();this.parms=e}upload(e){return i(this,null,function*(){let t=new b;t.addParm("reqtype","fileupload"),t.addParm("userhash",this.parms.required.userhash),yield t.addFile("fileToUpload",e);let r=t.pack(),o={url:"https://catbox.moe/user/api.php",method:"POST",headers:{"Content-Type":f},body:r};return yield new Promise((a,d)=>{(0,Oe.request)(o).then(s=>{let l=`![Catbox](${s})`;a(l)}).catch(s=>{d(s)})})})}};var J=class extends E.Plugin{constructor(){super(...arguments);this.initDone=!1}setupPasteHandler(){this.registerEvent(this.app.workspace.on("editor-drop",(e,t)=>i(this,null,function*(){let{files:r}=e.dataTransfer;this.startUpload(r,e,t)}))),this.registerEvent(this.app.workspace.on("editor-paste",(e,t)=>i(this,null,function*(){let{files:r}=e.clipboardData;this.startUpload(r,e,t)})))}startUpload(e,t,r){let o;if(e.length>0){switch(this.config.choice){case u.Github:o=new B(this.config.github_parms);break;case u.ImgURL:o=new H(this.config.imgurl_parms);break;case u.Cloudinary:o=new $(this.config.cloudinary_parms);break;case u.Smms:o=new V(this.config.smms_parms);break;case u.Imgbb:o=new j(this.config.imgbb_parms);break;case u.Imgur:o=new z(this.config.imgur_parms);break;case u.Catbox:o=new Y(this.config.catbox_parms);break;default:console.log(new E.Notice(n("broken"),2e3));return}if(o.isValid()){t.preventDefault();for(let a of e){let s=`![uploading...](${(Math.random()*10086).toString(36).slice(-6)})
`;r.replaceSelection(s),o.upload(a).then(l=>{let p=a.type.startsWith("image")?0:1;this.replaceText(r,s,l.slice(p))}).catch(l=>{this.replaceText(r,s,`[${this.config.choice} upload error]()`),console.log(new E.Notice(this.config.choice+n("upload error"),2e3)),console.log(l)})}}else console.log(new E.Notice(n("parms error"),2e3)),console.log(o)}}replaceText(e,t,r){t=t.trim();let o=[];for(let a=0;a<e.lineCount();a++)o.push(e.getLine(a));for(let a=0;a<o.length;a++){let d=o[a].indexOf(t);if(d!==-1){let s={line:a,ch:d},l={line:a,ch:d+t.length};e.replaceRange(r,s,l);break}}}onload(){return i(this,null,function*(){console.log("loading  Emo uploader"),yield this.loadSettings(),this.setupPasteHandler(),this.addSettingTab(new G(this.app,this))})}onunload(){console.log("unloading Emo uploader")}loadSettings(){return i(this,null,function*(){this.config=Object.assign({},qe,yield this.loadData())})}saveSettings(){return i(this,null,function*(){yield this.saveData(this.config)})}};0&&(module.exports={});
